[target]
name = "git-viz"
path = "/Users/dannyliu/personal_projects/git-viz"
branch = "main"
objective = """
Build a browser-based git repository visualizer with these components:

DEFAULT BEHAVIOR:
- When no repo path is specified, the app should visualize its own repository (the git-viz project itself at ~/personal_projects/git-viz)
- All API endpoints should default to the git-viz repo path when the `path` query parameter is omitted

BACKEND (FastAPI):
1. GET /api/repo?path=<path> -- Accept a local repo path, return repo metadata (name, branch, commit count, contributors). Default path: this repo.
2. GET /api/commits?path=<path>&limit=500 -- Return commit history: hash, author, date, message, files changed, insertions, deletions. Default path: this repo.
3. GET /api/tree?path=<path>&commit=<hash> -- Return file tree at a given commit with file sizes. Default path: this repo.
4. GET /api/activity?path=<path> -- Return contributor activity data: commits per author, commits over time (weekly buckets). Default path: this repo.
5. Serve the frontend HTML at GET /

FRONTEND (single self-contained HTML file with inline CSS/JS):
1. Force-directed graph (D3.js via CDN) showing files as nodes, directories as clusters
   - Node size = file size (log scale)
   - Node color = file extension (consistent color mapping)
   - Edges connect files modified in the same commit
   - Smooth physics simulation with drag interaction
2. Timeline slider at bottom to scrub through commit history
   - Play/pause button for animated playback
   - As timeline advances, nodes appear/disappear and edges update
   - Current commit info displayed (hash, author, message)
3. Sidebar with:
   - Contributor list with commit counts and color coding
   - Filter by author (click to toggle)
   - Filter by file path (search box)
4. Activity chart: small sparkline or bar chart showing commits over time
5. Dark theme, smooth CSS transitions, responsive layout
6. On load, fetch data without specifying a path (uses default = this repo)

ARCHITECTURE:
- Backend serves JSON, frontend fetches on load and caches
- No WebSocket needed -- load all data upfront, animate client-side
- The HTML file must be fully self-contained (inline styles, inline JS, CDN for D3 only)
- Must handle repos with 1000+ commits without freezing

TESTING:
- Backend tests using httpx TestClient against a temp git repo fixture
- Test each endpoint returns correct structure
- Test with empty repo, single-commit repo, multi-branch repo
- Test that endpoints work without path parameter (default to self)
"""

[target.verification]
command = ".venv/bin/python -m pytest -q && .venv/bin/ruff check src/"
timeout = 300
setup_command = "uv sync"
setup_timeout = 120

[scheduler]
session_timeout = 2700
model = "opus"

[scheduler.parallel]
num_workers = 2

[scheduler.budget]
max_per_session_usd = 10.0
max_per_run_usd = 50.0

[continuous]
max_wall_time_seconds = 7200
